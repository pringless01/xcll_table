// toolbar.js - global
(function(){
  let toolbar; function createToolbar(){ if(toolbar) return toolbar; const settings=window.ExcelHelperNS.getSettings(); toolbar=document.createElement('div'); toolbar.id='excel-helper-toolbar'; toolbar.style.cssText='position:fixed;top:10px;left:10px;z-index:10000;background:#fff;border:1px solid #ccc;padding:10px;border-radius:6px;font:12px system-ui;min-width:190px;box-shadow:0 4px 12px rgba(0,0,0,.15);cursor:move;'; toolbar.innerHTML=`<div style="font-weight:600;margin-bottom:6px;">Excel Helper</div><button id="eh-toggle" style="width:100%;padding:6px;border:none;border-radius:4px;background:${settings.selectionMode?'#28a745':'#0078D4'};color:#fff;cursor:pointer;">Seçim: ${settings.selectionMode?'AÇIK':'KAPALI'}</button><div style="display:flex;gap:4px;margin-top:6px;"><button id="eh-fastcopy" title="Seçimi kopyala" style="flex:1;padding:6px;border:none;border-radius:4px;background:#17a2b8;color:#fff;cursor:pointer;">Kopyala</button><button id="eh-export" style="flex:1;padding:6px;border:none;border-radius:4px;background:#6f42c1;color:#fff;cursor:pointer;">Excel</button></div><button id="eh-filters" style="width:100%;margin-top:6px;padding:6px;border:none;border-radius:4px;background:#ff9800;color:#fff;cursor:pointer;">Filtre Aç/Kapat</button><div style="margin-top:8px;font-size:10px;color:#666;text-align:center;">Sürükle</div>`; toolbar.style.left=settings.toolbarPosition.x+'px'; toolbar.style.top=settings.toolbarPosition.y+'px'; document.body.appendChild(toolbar); let down=false,sx=0,sy=0,ox=0,oy=0; toolbar.addEventListener('mousedown',e=>{ if(e.target.tagName==='BUTTON') return; down=true; sx=e.clientX; sy=e.clientY; const r=toolbar.getBoundingClientRect(); ox=r.left; oy=r.top; }); document.addEventListener('mousemove',e=>{ if(!down) return; const nx=ox+(e.clientX-sx); const ny=oy+(e.clientY-sy); toolbar.style.left=nx+'px'; toolbar.style.top=ny+'px'; }); document.addEventListener('mouseup',()=>{ if(down){ down=false; const r=toolbar.getBoundingClientRect(); window.ExcelHelperNS.updateToolbarPosition(r.left,r.top);} }); toolbar.querySelector('#eh-toggle').addEventListener('click',()=>{ const newMode=window.ExcelHelperNS.toggleSelectionMode(); const btn=toolbar.querySelector('#eh-toggle'); btn.textContent='Seçim: '+(newMode?'AÇIK':'KAPALI'); btn.style.background=newMode?'#28a745':'#0078D4'; if(!newMode){ window.ExcelHelperNS.clearSelection(); window.ExcelHelperNS.updateStatusPanel(); } }); toolbar.querySelector('#eh-export').addEventListener('click',()=>window.ExcelHelperNS.exportSelectionToExcel()); toolbar.querySelector('#eh-filters').addEventListener('click',()=>window.ExcelHelperNS.toggleFilters()); toolbar.querySelector('#eh-fastcopy').addEventListener('click',()=>{ const aoa=window.ExcelHelperNS.getSelectionAOA(); if(!aoa.length){ alert('Seçim yok'); return; } const txt=aoa.map(r=>r.join('\t')).join('\n'); navigator.clipboard.writeText(txt).then(()=>{ console.log('[ExcelHelper] Kopyalandı'); }).catch(()=>alert('Kopyalama başarısız')); }); return toolbar; }
  function initToolbar(){ createToolbar(); const bar=document.getElementById('excel-helper-toolbar'); if(!bar) return; // görünürlük ayarı
    const settings=window.ExcelHelperNS.getSettings(); if(!settings.toolbarVisible) bar.style.display='none';
    // Toggle için kısayol (Ctrl+Shift+E)
    document.addEventListener('keydown',e=>{ if(e.ctrlKey && e.shiftKey && e.key.toLowerCase()==='e'){ const ns=window.ExcelHelperNS.toggleToolbarVisible(); bar.style.display=ns?'block':'none'; } }); }
  window.ExcelHelperNS = window.ExcelHelperNS || {}; Object.assign(window.ExcelHelperNS,{initToolbar});
})();
